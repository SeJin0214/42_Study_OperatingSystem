# 스케줄링 : 멀티 레벨 피드백 큐

해결 하려는 문제점  
1. 짧은 작업을 먼저 실행시켜 반환시간 최적화
2. 대화형 사용자에게 응답이 빠른 시스템이라는 느낌을 주고 싶다.(응답 시간을 최적화)

## MLFQ : 기본 규칙
> 1. 우선순위(A) > 우선순위(B)이면, A가 실행된다. (B는 실행되지 않는다.)
> 2. 우선순위(A) = 우선순위(B)이면, A와 B는 RR방식으로 실행된다.
> 3. 작업이 시스템에 진입하면, 가장 높은 우선순위, 즉 맨 위의 큐에 놓여진다.
> 4. a 주어진 타임 슬라이스를 모두 사용하면 우선순위는낮아진다. 즉, 한 단계
아래 큐로 이동한다.
> 4. b 타임 슬라이스를 소진하기 전에 CPU를 양도하면같은 우선순위를 유지한다
> 5. 일정 기간 S 가 지나면, 시스템의 모든 작업을 최상위 큐로 이동시킨다.

>향상된 규칙
> 1. : 우선순위 (A)> 우선순위 (B) 일 경우, A가 실행, B는 실행되지 않는다.
> 2. : 우선순위 (A) = 우선순위 (B), A와 B는 RR 방식으로 실행된다.
> 3. : 작업이 시스템에 들어가면 최상위 큐에 배치된다.
> 4. : 작업이 지정된 단계에서 배정받은 시간을 소진하면 (CPU를 포기한 횟수와 상관없이), 작업의 우선순위는감소한다 (즉, 한 단계 아래 큐로 이동한다).
> 5. : 일정 주기 S 가 지난 후, 시스템의 모든 작업을 최상위 큐로 이동시킨다.

MLFQ란?  
1. 여러개의 큐 구성(각각 다른 우선순위가 배정된다.)
2. 프로세스는 이중 하나의 큐에 존재한다.
3. 높은 우선순위큐에 존재하는 작업이 선택된다.
4. 큐에 둘 이상의 작업이 존재할 수 있다.(RR 방식을 사용한다.)
5. 핵심은 우선 순위를 정하는 방식이다.  
	5.1 우선순위는 CPU를 양보 할 수록 우선순위가 증가한다.
	5.2 우선순위는 CPU를 집중사용 하면 우선순위가 감소한다.

## 8.2 시도 1: 우선순위의 변경
>한 개의 긴 실행 시간을 가진 작업  
그림 <8.2> 처럼 작업은 최상위 Que로 이동 타임 슬라이스를 사용하면 Que가 다운되고  
결국 가장 낮은 Que로 이동하게 된다.

> 짧은 작업과 함께  
그림 <8.3>과 같이 A는 cpu작업 B는 짧은 대화형 작업 이때 A는 오래 실행됨 그러다 B가 진입!!  
A 는 마직막 Que에 놓여져 있고, B는 최상위 Que에 올라가 있다. 그리고 스케줄러는 B를 타임 슬라이스 만큼  
실행 후 B의 우선순위를 다운 마지막이 Que에 가기도전에 B의 작업은 종료가 되고, A가 다시 실행이된다.  
이렇게 SJF를 비슷하게 따라갈 수 있다.

> 그럼 입출력은 어떻게????
그림<8.4>를 보면 작업 B는 입출력 수행으로 높은 Que에 우선되어 있다.  
작업 A는 입출력이 없기 때문에 계속해서 낮은 Que에 놓여져 있다.  
즉 해결하려는 문제점 2에 근접하게 스케쥴을 하고 있다.

* 현재 MLFQ의 문제점
1. 만약 cpu를 양보하는 작업이 너무 많은데 같은 랭크에 위치하고 있는데 하위에 양보하지 않는 작업이 있다면??  
굶게 된다.
2. 만약 악성 사용자가 일부러 Que의 우선순위를 높은것 처럼보이기 위해서 유리하게 동작하게 만든다면???

## 시도 2: 우선순위의 상향 조정
* 기아 프로세스를 막기위해 규칙5를 넣는다
>5. : 일정 주기 S 가 지난 후, 시스템의 모든 작업을 최상위 큐로 이동시킨다.

이렇게 하면 배치형 작업도 기회를 얻는다.  
하지만 S를 결정하는게 어렵지만 그래도 공정하게 작업이 이루어 지려면 어려운 문제를 해결하자.

## 시도 3: 더 나은 시간 측정
* 유리한 동작을 막으려면 규칙 4를 보완한다.
> 4. : 작업이 지정된 단계에서 배정받은 시간을 소진하면 (CPU를 포기한 횟수와 상관없이), 작업의 우선순위는감소한다 (즉, 한 단계 아래 큐로 이동한다).

즉 특정 타임슬라이스를 소진하면 Que의 우선순위를 아래로 내린다.  
이렇게 하면 유리한 동작을 막을 수 있다.

## MLFQ 조정과 다른 쟁점들
1. 몇개의 큐가 존재해야하는가?
2. 큐당 타임 슬라이스의 크기는 얼마로 해야하는가?
3. 기아를 피하는법?

* 보완한 방법  
Que 별로 타임슬라이스의 범위를 다르게 한다.  
Que의 최상위 우선순위는 운영체제 작업을 위해 예약해 둔다.