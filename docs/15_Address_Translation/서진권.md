# 주소 변환의 원리

> 핵심질문  
> 1. 어떻게 효율적인 메모리 가상화를 구축할 수 있을까? 
> 2. 프로그램이 필요로 하는유연성을 어떻게 제공하는가
> 3. 프로그램이 접근할 수 있는 메모리의 위치에 대한 제어를  
어떻게 유지 하는가
> 4. 메모리 접근을 어떻게 적절히 제한할 수 있는가

우리가 다룰 기법  
하드웨어 기반 주소 변환 -> 주소 변환  
> 가상의 주소를 물리적인 주소로 변환한는 것.  
중요한건 츠로그램이 자신의 전용 메모리를 가지고 있고 그곳에서  
코드자신의 코드와 데이터가 있다고 환상을 심어주는 것.

## 사례
프로그램 관점에서 주소 공간은 주소 0부터 시작하여 최대  
16KB까지이다.  
프로그램이 생성하는 모든 메모리 참조는 이 범위 내에 있어야 한다.  
운영체제는 이공간을 0이아닌 다른곳에 재배치하고 싶다.  
어떻게 할까?  

### 동적(하드웨어 기반) 재배치
>베이스와 바운드  ->  aka동적 재배치  
 베이스 레지스터와 바운드(한계) 레지스터 필요  
 이 두쌍은 우리가 원하는 위치에 주소 공간을 배치할 수 있게 한다.  
 변환 과정  
 -> physical address = virtual address + base;  
 프로세스가 생성하는 메모리 참조는 가상주소이다.  
 하드웨어는 베이스 레지스터의 내용을 이 주소에 더하여  
 물리 주소 생성  
 프로세스가 실행을 시작한 이후에도 주소 공간을 이동할 수  
 있기 때문에, 동적 재배치 라고도 불린다.  
 바운드 레지스터는 항산 16kb로 설정이되고, 프로세스 바운드가  
 범위안에 있는지 확인한다.  

 바운드 레지스터의 방식  
 1. 공간의 크기를 저장하는 방식  
 2. 주소 공간의 머자먹 물리 주소를 저장하고 검사하는 방식

 ### 요약 (흐름)
 1. 운영체제는 특권모드에서 실행  
 2. 응용프로그램은 사용자 모드에서 실행  
 3. 하드웨어는 자체적으로 베이스와 레지스터를 자체적으로 제공  
 3.1 cpu는 메모리 관리 장치의 일부인 추가의 레지스터 쌍을 가진다.  
 4. 하드웨어는 베이스와 바운드 레지스터를 변경할 수 있는 명령어  
 재공 해야한다.  
 4.1 운영체제는 다른프로세스를 실행할때 이명령어로 베이스와  
 바운드 레지스터값을 변경할 수 있어야한다.(특권 명령어임 ->  
 커널 모드에서만 변경가능!!!)  
 5. cpu는 사용자 프로그램이 바운드를 벗어난 주소로 불법적인  
 메모리 접근을 시도하는 순간 예외를 발생시킬 수 있어야한다.  

 ### 운영체제 이슈
 1. 프로게스가 생성될 때 운영체제는 주소 공간이 저장될  
 메모리 공간을 찾아 조치를 취해야한다.  
 2. 프로세스가 종료할 때 , 즉 정상적으로 종료될 때 또는 잘못된  
 행동을 허요 강제적으로 죽게될 때 프로세스가 사용하던 메모리를  
 회수하여 다른 프로세스나 운영체제가 사용할 수 있어야 한다.  
 3. 운영체제는 문맥 교환이 일어날 때에도 몇 가지 추가 조치를  
 해야한다.  
4. 운영채제는 예외 핸들러 또는 호출될 함수를 제공해야한다.  