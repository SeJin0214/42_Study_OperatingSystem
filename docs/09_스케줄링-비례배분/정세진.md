# 스케줄링 : 비례 배분(Proportional Share) 또는 공정 배분(Fair share) 이라 말함

<aside>
💡 왜 쓰는 가?

**반환 시간이나 응답 시간을 최적화하는 대신** 스케줄러가 각 **작업에게 CPU의 일정 비율을 보장하는 것이 목적**

어떻게 CPU를 정해진 비율로 배분할 수 있는가?

</aside>

## 추첨 스케줄링(lottery scheduling)

<aside>
🎫 추첨권(티켓)

- 이 스케줄링의 근간
- 프로세스가 받아야 할 자원의 몫을 나타내는 데 사용
</aside>

- **무작위성**을 이용한다
    - 장점
        - 특이한 상황을 잘 대처
        - 매우 가벼움(프로세스의 상태 정보만 필요)
        - 매우 빠르다.

많이 실행될수록 정규 분포에 따라 원하는 비율을 달성할 가능성이 높아진다.

### 추첨 기법

1. 추첨권 화폐
    1. CPU가 나라이고 추첨권을 예산이라 보자
    2. 여러 프로세스(시, 도) 추첨권(시,도 예산)을 할당 받았다.
    3. 프로세스(A)가 자신만의 화폐로 만들어(지역 화폐, 어음, 주식) 세부적인 프로세스(A1, A2)에게 할당하였다. 
2. 추첨권 양도(ticket transfer)
    1. 어느 프로세스의 추첨권을 다른 프로세스에게 넘겨줄 수 있음
    2. 클라/서버 환경에서 유용
    3. 클라가 서버에게 요청하면서 추첨권까지 양도하여 서버가 빠르게 진행하도록 도운다. 
3. 추첨권 팽창
    1. 일시적으로 자신이 소유한 추첨권의 수를 늘리거나 줄일 수 있다.(채권을 발행하여 예산을 늘릴 수 있다.)
    2. 서로 신뢰 가능한 프로세스들일 때 유용하다. (갚을 능력이 없이 돈만 찍어낸다면 인플레이션이 올 것)
    3. 시스템에게 많은 CPU시간이 필요하다고 알림 

### 구현

- 난수 발생기
- 자료 구조 (Set)
- 추첨권의 전체 개수
- 매우 간단
    
    ![Untitled](image\code.png)
    
- 리스트 내림차순 정렬이 매우 효율적

### 불공정 지표

U = 첫 번째 작업이 종료된 시간 / 두 번째 작업이 종료된 시간 

우리는 두 작업을 거의 동시에 종료시키고자 하려나, 추첨 스케줄링의 무작위성 때문에 한 작업이 다른 작업보다 먼저 종료될 수 있다.

차이의 정량화를 위해 정해 놓은 것 

![Untitled](image\lottery_scheduling_img_12_2.png)

실행 시간이 길수록 공정성이 높아진다. 

<aside>
💡 추첨권을 몇 개씩 분배해야 하는가?

- 시스템 동작이 할당 방식에 따라 크게 달라진다. (매우 중요)
</aside>

### 무작위성의 한계

어느 정도 정확하고 빠르게 할 수 있지만, 짧은 기간만 실행되는 경우엔 정확한 비율을 보장 할 수 없다.

### 보폭 스케줄링(stride scheduling)

결정론적 공정 배분 스케줄러

- 보폭
    - 추첨권 수에 반비례하는 값
    - 추첨권 수가 많다면, 더 짧은 간격으로 스케줄링
    - ex) 프로세스에게 할당 받은 추첨권 수(10000) / 세부 프로세스(250) = 보폭(40)

가장 작은 pass 값을 가진 프로세스를 선택하고, 프로세스가 실행될 때마다 보폭만큼 pass값을 증가 시킨다.

### 요약

- 추첨권 스케줄링은 무작위성을 사용
- 보폭 스케줄링은 결정적 방법으로 달성
- 둘 다 널리 사용하지 않음
- 입출력과 맞물렸을 때 제대로 동작하지 않음

### 좀 더 확인이 필요한 것

무작위성(randomness)은 확률적 알고리즘**(Randomized algorithm)**을 말하는 거 같다.