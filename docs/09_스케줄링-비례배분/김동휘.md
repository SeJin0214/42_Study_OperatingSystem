# 스케줄링: 비례 배분

비례 배분 (Proportional Share) ; 공정 배분 (fair share)  
: 변환 시간이나 응답 시간을 최적화 하는 대신 스케줄러가 각 작업에게 CPU의 일정 비율을 보장.  
</br>
예시_추첨 스케줄링(lottery scheduling) : 다음 실행될 프로세스를 추첨을 통해 결정. 더 자주 수행되어야 하는 프로세스는 당첨 기회를 더 많이 주는 느낌.
</br>
</br>
## 1. 기본 개념: 추첨권이 당신의 몫을 나타낸다
추첨권(티켓)이 근간이며 프로세스(혹은 사용자 등)가 받아야 할 자원의 몫을 나타내는 데 사용된다.  
</br>
예를 들어 A는 75장의 추첨권, B는 25장의 추첨권을 가지고 있다면 각각 CPU를 75%, 25% 할당한다.  
목적은 타임슬라이스의 끝마다 확률적이지만 결정적이지 않은 추첨이다.  
</br>
* 추첨권 스케줄링의 큰 장점중 하나는 무작위성!  
</br>
## 2. 추첨 기법
다양한 기법이 있다.

#### 1) 추첨권 화폐(ticket currency)
	사용자가 추첨권을 자신의 화폐 가치로 자유롭게 할당할 수 있도록 허용한다.  

#### 2) 추첨권 양도(ticket transfer)
	잃시적으로 추첨권을 다른 프로세스에게 넘겨줄 수 있다.
	클라이이언트<->서버 환경에서 특히 유용하다.

#### 3) 추첨권 팽창(ticket inflation)
	일시적으로 자신이 소유한 추첨권의 수를 변경할 수 있다. 서로 경쟁하지 않고 신뢰하는 프로세스간에 유용하다. 
</br>
</br>

## 3. 구현
추첨 스케줄링의 가장 큰 장점은 구현이 단순하다는 것.  
</br>
준비물 :  
난수발생기 / 프로세스의 집합 자료구조(리스트 등) / 추첨권의 전체 개수
</br>
</br>
![titled](image/lottery_scheduling_img_12_1.png)
리스트를 사용하여 A,B,C 프로세스를 관리한다고 가정  
-> 추첨권의 총 갯수 400개 설정.  
-> 한 개의 숫자를 선택 (예를 들어 300)  
-> 리스트를 순회하며 당첨자를 찾아낸다.  

	구체적으로는 아마 순서대로 0~99까지, 100~149까지, 150~249까지 가지고 있는 듯, 그래서 처음 A티켓 개수 더했을 때 100, 그 다음 B티켓 더했을 때 150, 그리고 마지막으로 C티켓까지 더하니 400이 되어 300을 초과했으므로 C가 당첨되었다고 빠르게 계산하는듯.
</br>

## 4.
작업의 길이가 길지 않으면 불공정이 심각해지며, 작업이 충분히 실행되어야 추첨 스케줄러가 원하는 결과에 가까워진다.

## 5. 추첨권 배분 방식
작업들에 추첨권을 몇 개씩 분배해야 하는가? 어려운 문제다.  
주어진 작업 집합에 대한 추첨권 할당 문제는 여전히 미해결 상태다.

## 6. 왜 결정론적 방법 사용하지 않는가?
무작위성을 이용하면 스케줄러는 단순하게 만들 수 있지만, 정확한 비율을 보장할 수 없다. 그래서 보폭 스케줄링(stride scheduling)이 고안되었다.  
 보폭은 가진 추첨권 수에 반비례하는 값이다. 예를 들어, 프로세스들이 각각 A: 100, B: 50, C: 250개의 추첨권을 가지고 있다면, 10,000을 나누면 보폭은 100, 200, 40이 된다.  
 프로세스가 실행될 때마다 pass라는 값을 보폭만큼 증가시켜 얼마나 CPU를 사용했는지 추적한다.  

 1) 가장 작은 pass값을 가진 프로세스를 선택한다.
	처음에는 모두 0에서 시작하기에 아무 프로세스나 시작한다.
 2) 실행시킬 때 마다 pass값을 보폭만큼씩 증가시킨다.
	A가 실행되면 타임슬라이스만큼 실행후 종료될 때 pass값이 100으로 갱신된다.
	다음 B는 200, C는 40으로 갱신된다. 
 3) 이 시점에서 가장 작은 pass값을 가진 C를 선택하여 80으로 갱신한다.
4) 이러한 선택이 계속 반복된다.  

이렇게 실행한 회수를 비교하면 각 추첨권 갯수와 정확히 비례한다.  
하지만 추첨 스케줄링은 프로세스 상태(CPU사용현황, pass값 등)을 유지할 필요가 없다. 새 프로세스 추가할 때 새로운 프로세스가 가진 추첨권의 개수, 전체 추첨권 개수만 갱신하고 스케줄하기에, 추첨 스케줄링에서는 새 프로세스를 쉽게 추가할 수 있다.